<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href = "event.css">
  <title>Event Management Form</title>
</head>
<body>
  <div id="navbar-placeholder"></div>
  <form id="eventForm" class = "container">
    <h2>Event Management Form</h2>

    <label for="name">Event Name</label>
    <input type="text" id="name" name="name" required>

    <label for="description">Event Description</label>
    <textarea id="description" name="description" required></textarea>

    <label for="date">Event Date</label>
    <input type="date" id="date" name="date" required>

    <label for="location">Location</label>
    <input type="text" id="location" name="location" required>

    <label for="state">State</label>
    <select id="state" name="state" required>
      <option value="">Loading states...</option>
    </select>

    <label for="max_volunteers">Max Volunteers</label>
    <input type="number" id="max_volunteers" name="max_volunteers" placeholder="e.g. 30">

    <label for="required_skills">Required Skills</label>
    <input type="text" id="required_skills" name="required_skills" placeholder="e.g. Teamwork, Leadership">

    <label for="urgency">Urgency</label>
    <select id="urgency" name="urgency">
      <option value="">Select urgency</option>
      <option value="Low">Low</option>
      <option value="Medium">Medium</option>
      <option value="High">High</option>
    </select>

    <button type="submit">Submit Event</button>
  </form>

  <div id="eventsContainer" class="event-list">
    <h2>Existing Events</h2>
    <div id="eventsList" class = "eventList"></div>
  </div>

  <script type="module">
    import { loadNavbar } from "../../../backend/Navbar/loadNavbar.js";
    loadNavbar();
  </script>

  <script>
    const API_URL = 'http://localhost:3000/events';
    const STATES_URL = 'http://localhost:3000/states';

<<<<<<< HEAD
    // Load states for dropdown
=======
    //  Load states for dropdown
>>>>>>> 573f7327a23dc3e706edc172ff2a2fa6f110871c
    async function loadStates() {
      try {
        const res = await fetch(STATES_URL);
        const states = await res.json();

        const select = document.getElementById('state');
        select.innerHTML = '<option value="">Select a state</option>';

        states.forEach(st => {
          const option = document.createElement('option');
          option.value = st.state_id;
          option.textContent = `${st.state_name} (${st.state_code})`;
          select.appendChild(option);
        });
      } catch (err) {
        console.error(' Error loading states:', err);
        document.getElementById('state').innerHTML = '<option>Error loading states</option>';
      }
    }

    //  Submit new event
    document.getElementById('eventForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const eventData = {
        name: document.getElementById('name').value.trim(),
        description: document.getElementById('description').value.trim(),
        date: document.getElementById('date').value,
        location: document.getElementById('location').value.trim(),
        state_id: parseInt(document.getElementById('state').value) || null,
        max_volunteers: parseInt(document.getElementById('max_volunteers').value) || null,
        required_skills: document.getElementById('required_skills').value.trim(),
        urgency: document.getElementById('urgency').value.trim()
      };

      try {
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(eventData)
        });
        const data = await response.json();

        if (response.ok) {
          alert(' Event added successfully!');
          loadEvents();
          document.getElementById('eventForm').reset();
        } else {
          alert(' Error: ' + JSON.stringify(data.errors || data.error));
        }
      } catch (err) {
        console.error(' Fetch failed:', err);
        alert(' Could not connect to backend.');
      }
    });

<<<<<<< HEAD
    //  Load events
=======
    // Load events
>>>>>>> 573f7327a23dc3e706edc172ff2a2fa6f110871c
    async function loadEvents() {
      try {
        const response = await fetch(API_URL);
        const events = await response.json();

        const eventsList = document.getElementById('eventsList');
        eventsList.innerHTML = '';

        if (events.length === 0) {
          eventsList.innerHTML = '<p>No events found.</p>';
          return;
        }

        events.forEach(event => {
          const div = document.createElement('div');
          div.classList.add('event-card');
          div.innerHTML = `
            <h3>${event.event_name}</h3>
            <p><strong>Description:</strong> ${event.event_description}</p>
            <p><strong>Date:</strong> ${new Date(event.event_date).toLocaleDateString()}</p>
            <p><strong>Location:</strong> ${event.location}</p>
            <p><strong>State:</strong> ${event.state_name || 'N/A'}</p>
            <p><strong>Max Volunteers:</strong> ${event.max_volunteers || 'N/A'}</p>
            <p><strong>Required Skills:</strong> ${event.required_skills || 'N/A'}</p>
            <p><strong>Urgency:</strong> ${event.urgency || 'N/A'}</p>
          `;
          eventsList.appendChild(div);
        });
      } catch (err) {
        console.error(' Error fetching events:', err);
        document.getElementById('eventsList').innerHTML = '<p>Error loading events.</p>';
      }
    }

<<<<<<< HEAD
    //  Initialize page
=======
    // Initialize page
>>>>>>> 573f7327a23dc3e706edc172ff2a2fa6f110871c
    loadStates();
    loadEvents();
  </script>
</body>
</html>
